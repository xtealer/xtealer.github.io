(this["webpackJsonpjsnes-web"]=this["webpackJsonpjsnes-web"]||[]).push([[0],{46:function(e,t,n){e.exports=n(78)},51:function(e,t,n){},74:function(e,t,n){},75:function(e,t,n){},76:function(e,t,n){},77:function(e,t,n){},78:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(20),s=n.n(o),i=n(7),l=n(8),u=n(12),c=n(11),m=n(13),p=n(18),d=n(17),h=(n(51),n(79)),f={ROMS:{1943:{name:"1943",url:"../roms/1943.nes"},"Bugs Bunny Crazy Castle":{name:"Bugs Bunny Crazy Castle",url:"../roms/Bugs Bunny Crazy Castle.nes"},"Castlevania 2 - Simon's Quest (U)":{name:"Castlevania 2 - Simon's Quest (U)",url:"../roms/Castlevania 2 - Simon's Quest (U).nes"},"Castlevania 3 - Dracula's Curse (U)":{name:"Castlevania 3 - Dracula's Curse (U)",url:"../roms/Castlevania 3 - Dracula's Curse (U).nes"},Castlevania:{name:"Castlevania",url:"../roms/Castlevania.nes"},"Guerrilla War (U)":{name:"Guerrilla War (U)",url:"../roms/Guerrilla War (U).nes"},"Star Trek - 25th Anniversary":{name:"Star Trek - 25th Anniversary",url:"../roms/Star Trek - 25th Anniversary.nes"},"Star Trek - The Next Generation (U)":{name:"Star Trek - The Next Generation (U)",url:"../roms/Star Trek - The Next Generation (U).nes"},"Star Voyager":{name:"Star Voyager",url:"../roms/Star Voyager.nes"},"Star Wars - The Empire Strikes Back":{name:"Star Wars - The Empire Strikes Back",url:"../roms/Star Wars - The Empire Strikes Back.nes"},"Star Wars":{name:"Star Wars",url:"../roms/Star Wars.nes"},"Starship Hector":{name:"Starship Hector",url:"../roms/Starship Hector.nes"},"Super Mario Bros 2":{name:"Super Mario Bros 2",url:"../roms/Super Mario Bros 2.nes"},"Super Mario Bros 3":{name:"Super Mario Bros 3",url:"../roms/Super Mario Bros 3.nes"},Yoshi:{name:"Yoshi",url:"../roms/Yoshi.nes"},"Zelda 2 - The Adventure of Link":{name:"Zelda 2 - The Adventure of Link",url:"../roms/Zelda 2 - The Adventure of Link.nes"},arkanoid:{name:"arkanoid",url:"../roms/arkanoid.nes"},"contra-1":{name:"contra-1",url:"../roms/contra-1.nes"},croom:{name:"croom",url:"../roms/croom.nes"},galaga:{name:"galaga",url:"../roms/galaga.nes"},"kirby-adventures-1":{name:"kirby-adventures-1",url:"../roms/kirby-adventures-1.nes"},lj65:{name:"lj65",url:"../roms/lj65.nes"},"lunar-pool":{name:"lunar-pool",url:"../roms/lunar-pool.nes"},mappy:{name:"mappy",url:"../roms/mappy.nes"},"pac-man":{name:"pac-man",url:"../roms/pac-man.nes"},"road-fighter":{name:"road-fighter",url:"../roms/road-fighter.nes"},starforce:{name:"starforce",url:"../roms/starforce.nes"},"tetris-original":{name:"tetris-original",url:"../roms/tetris-original.nes"},xevious:{name:"xevious",url:"../roms/xevious.nes"}}},g={getRomInfoByHash:function(e){return this.load().find((function(t){return t.hash===e}))},save:function(e){return function(e){return new Promise((function(t,n){var a=new FileReader;a.onload=t,a.readAsBinaryString(e)}))}(e).then((function(e){var t=e.target.result;return function(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),a=0;a<e.length;a++)n[a]=e.charCodeAt(a);return crypto.subtle.digest("SHA-1",t).then((function(e){return Array.from(new Uint8Array(e)).map((function(e){return e.toString(16).padStart(2,"0")})).join("")}))}(t).then((function(e){return{hash:e,byteString:t}}))})).then((function(t){var n=t.hash,a=t.byteString,r=localStorage.getItem("savedRomInfo"),o=r?JSON.parse(r):[],s={name:e.name,hash:n,added:Date.now()},i=JSON.stringify(o.concat([s]));return localStorage.setItem("savedRomInfo",i),localStorage.setItem("blob-"+n,a),s}))},load:function(){return localStorage.getItem("savedRomInfo")&&JSON.parse(localStorage.getItem("savedRomInfo"))||[]},delete:function(e){var t=this.load();localStorage.removeItem("blob-"+e),localStorage.setItem("savedRomInfo",JSON.stringify(t.filter((function(t){return t.hash!==e}))))}},y=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this,e))).deleteRom=function(e){g.delete(e),n.updateLibrary()},n.updateLibrary=function(){n.setState({romLibrary:g.load()})},n.handleDragOver=function(e){e.preventDefault(),e.dataTransfer.dropEffect="copy"},n.handleDrop=function(e){e.preventDefault();var t=e.dataTransfer.items?e.dataTransfer.items[0].getAsFile():e.dataTransfer.files[0];g.save(t).then((function(e){n.updateLibrary(),n.props.history.push({pathname:"/run/local-"+e.hash})}))},n.state={romLibrary:g.load()},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"container ListPage my-4",onDragOver:this.handleDragOver,onDrop:this.handleDrop},r.a.createElement("div",{className:"row justify-content-center"},r.a.createElement("div",{className:"col-md-8"},r.a.createElement("header",{className:"mb-4"},r.a.createElement("h1",{className:"mb-3"},"JSNES"),r.a.createElement("p",null,"A JavaScript NES emulator."," ",r.a.createElement("a",{href:"https://github.com/bfirsh/jsnes"},"Source on GitHub."))),r.a.createElement(h.a,{className:"mb-4"},Object.keys(f.ROMS).sort().map((function(e){return r.a.createElement(p.b,{key:e,to:"/run/"+encodeURIComponent(e),className:"list-group-item"},f.ROMS[e].name,r.a.createElement("span",{className:"float-right"},"\u203a"))}))),r.a.createElement("p",null,"Or, drag and drop a ROM file onto the page to play it. (Google may help you find them.)"),this.state.romLibrary.length>0?r.a.createElement("div",null,r.a.createElement("p",null,"Previously played:"),r.a.createElement(h.a,{className:"mb-4"},this.state.romLibrary.sort((function(e,t){return new Date(t.added)-new Date(e.added)})).map((function(t){return r.a.createElement(p.b,{key:t.hash,to:"/run/local-"+t.hash,className:"list-group-item"},t.name,r.a.createElement("a",{onClick:function(n){n.preventDefault(),e.deleteRom(t.hash)},className:"delete",title:"Delete"},"\xd7"),r.a.createElement("span",{className:"float-right"},"\u203a"))})))):null)))}}]),t}(a.Component),v=n(84),b=n(85),C=n(22),k=n(45),B=n(43),T=n(16),O=n(86),w=n(80),S=n(81),N=n(82),E=n(83),U=n(4),I=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this,e))).state={playerOneButton:"",playerTwoButton:"",waitingForKey:0},n.handleClick=n.handleClick.bind(Object(T.a)(n)),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.keys,t=this.props.button,n=[];for(var a in e)1===e[a][0]&&e[a][1]===t?(n[0]=e[a][2],console.log(n[0])):2===e[a][0]&&e[a][1]===t&&(n[1]=e[a][2]);this.setState({playerOneButton:n[0],playerTwoButton:n[1]})}},{key:"componentDidUpdate",value:function(e,t){var n,a,r=this.props.keys,o=this.props.button,s=[];for(var i in r)1===r[i][0]&&r[i][1]===o?(s[0]=r[i][2],console.log(s[0])):2===r[i][0]&&r[i][1]===o&&(s[1]=r[i][2]);var l=function(e,t){return e.buttons.filter((function(e){return e.buttonId===t}))[0]},u=function(e,t){return t.buttons.filter((function(t){return!e||!e.buttons.some((function(e){return e.buttonId===t.buttonId}))}))[0]},c=0,m=0,p=function(e){return"button"===e.type?"Btn-"+e.code:"axis"===e.type?"Axis-"+e.code+" "+e.value:void 0};if(this.props.gamepadConfig&&this.props.gamepadConfig.playerGamepadId){var d=this.props.gamepadConfig.playerGamepadId;d[0]&&(s[0]="",n=l(this.props.gamepadConfig.configs[d[0]],o),a=u(e.gamepadConfig.configs[d[0]],this.props.gamepadConfig.configs[d[0]]),n?s[0]=p(n):a&&a.buttonId===this.props.prevButton&&(c||(c=1,m=1))),d[1]&&(s[1]="",n=l(this.props.gamepadConfig.configs[d[1]],o),a=u(e.gamepadConfig.configs[d[1]],this.props.gamepadConfig.configs[d[1]]),n?s[1]=p(n):a&&a.buttonId===this.props.prevButton&&(c||(c=2,m=2)))}var h={};c&&this.props.handleClick([m,this.props.button]),t.playerOneButton===s[0]&&t.playerTwoButton===s[1]||(h.playerOneButton=s[0],h.playerTwoButton=s[1]),c?h.waitingForKey=c:1===t.waitingForKey?this.props.currentPromptButton!==this.props.button&&(h.waitingForKey=0):2===t.waitingForKey&&this.props.currentPromptButton!==this.props.button&&(h.waitingForKey=0),Object.keys(h).length>0&&this.setState(h)}},{key:"handleClick",value:function(e){this.props.handleClick([e,this.props.button]),this.setState({waitingForKey:e})}},{key:"render",value:function(){var e=this;return r.a.createElement("tr",null,r.a.createElement("td",null,this.props.buttonName),r.a.createElement("td",{onClick:function(){return e.handleClick(1)}},1===this.state.waitingForKey?"Press key or button...":this.state.playerOneButton),r.a.createElement("td",{onClick:function(){return e.handleClick(2)}},2===this.state.waitingForKey?"Press key or button...":this.state.playerTwoButton))}}]),t}(a.Component),D="../img/nes_controller.png",F=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this,e))).state={gamepadConfig:e.gamepadConfig,keys:e.keys,button:void 0,modified:!1},n.handleKeyDown=n.handleKeyDown.bind(Object(T.a)(n)),n.handleGamepadButtonDown=n.handleGamepadButtonDown.bind(Object(T.a)(n)),n.listenForKey=n.listenForKey.bind(Object(T.a)(n)),n.state.gamepadConfig=n.state.gamepadConfig||{},n.state.gamepadConfig.playerGamepadId=n.state.gamepadConfig.playerGamepadId||[null,null],n.state.gamepadConfig.configs=n.state.gamepadConfig.configs||{},n.state.controllerIcon=n.state.gamepadConfig.playerGamepadId.map((function(e){return e?D:"../img/keyboard.png"})),n.state.controllerIconAlt=n.state.gamepadConfig.playerGamepadId.map((function(e){return e?"gamepad":"keyboard"})),n.state.currentPromptButton=-1,n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentWillUnmount",value:function(){this.state.modified&&(this.props.setKeys(this.state.keys),this.props.setGamepadConfig(this.state.gamepadConfig)),this.removeKeyListener()}},{key:"listenForKey",value:function(e){var t=e[1];this.removeKeyListener(),this.setState({button:e,currentPromptButton:t}),this.props.promptButton(this.handleGamepadButtonDown),document.addEventListener("keydown",this.handleKeyDown)}},{key:"handleGamepadButtonDown",value:function(e){this.removeKeyListener();var t=this.state.button,n=t[0],a=t[1],r=e.gamepadId,o=this.state.gamepadConfig,s=o.playerGamepadId.slice(0),i={};s[n-1]=r;var l={code:e.code,type:e.type,buttonId:a,value:e.value};i[r]={buttons:(o.configs[r]||{buttons:[]}).buttons.filter((function(e){return e.buttonId!==a})).concat([l])};var u=Object.assign({},o.configs,i);this.setState({gamepadConfig:{configs:u,playerGamepadId:s},currentPromptButton:-1,controllerIcon:s.map((function(e){return e?D:"../img/keyboard.png"})),modified:!0})}},{key:"handleKeyDown",value:function(e){this.removeKeyListener();var t=this.state.button,n=this.state.keys,a={};for(var r in n)n[r][0]===t[0]&&n[r][1]===t[1]||(a[r]=n[r]);var o=this.state.gamepadConfig.playerGamepadId.slice(0);o[t[0]-1]=null,this.setState({keys:Object(B.a)({},a,Object(C.a)({},e.keyCode,[].concat(Object(k.a)(t.slice(0,2)),[e.key.length>1?e.key:String(e.key).toUpperCase()]))),button:void 0,gamepadConfig:{configs:this.state.gamepadConfig.configs,playerGamepadId:o},currentPromptButton:-1,controllerIcon:o.map((function(e){return e?D:"../img/keyboard.png"})),controllerIconAlt:o.map((function(e){return e?"gamepad":"keyboard"})),modified:!0})}},{key:"removeKeyListener",value:function(){this.props.promptButton(null),document.removeEventListener("keydown",this.handleKeyDown)}},{key:"render",value:function(){return r.a.createElement(O.a,{isOpen:this.props.isOpen,toggle:this.props.toggle,className:"ControlsModal"},r.a.createElement(w.a,{toggle:this.props.toggle},"Controls"),r.a.createElement(S.a,null,r.a.createElement(N.a,null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Button"),r.a.createElement("th",null,"Player 1",r.a.createElement("img",{className:"controller-icon",src:this.state.controllerIcon[0],alt:this.state.controllerIconAlt[0]})),r.a.createElement("th",null,"Player 2",r.a.createElement("img",{className:"controller-icon",src:this.state.controllerIcon[1],alt:this.state.controllerIconAlt[1]})))),r.a.createElement("tbody",null,r.a.createElement(I,{buttonName:"Left",currentPromptButton:this.state.currentPromptButton,button:U.Controller.BUTTON_LEFT,prevButton:U.Controller.BUTTON_SELECT,keys:this.state.keys,handleClick:this.listenForKey,gamepadConfig:this.state.gamepadConfig}),r.a.createElement(I,{buttonName:"Right",currentPromptButton:this.state.currentPromptButton,button:U.Controller.BUTTON_RIGHT,prevButton:U.Controller.BUTTON_LEFT,keys:this.state.keys,handleClick:this.listenForKey,gamepadConfig:this.state.gamepadConfig}),r.a.createElement(I,{buttonName:"Up",currentPromptButton:this.state.currentPromptButton,button:U.Controller.BUTTON_UP,prevButton:U.Controller.BUTTON_RIGHT,keys:this.state.keys,handleClick:this.listenForKey,gamepadConfig:this.state.gamepadConfig}),r.a.createElement(I,{buttonName:"Down",currentPromptButton:this.state.currentPromptButton,button:U.Controller.BUTTON_DOWN,prevButton:U.Controller.BUTTON_UP,keys:this.state.keys,handleClick:this.listenForKey,gamepadConfig:this.state.gamepadConfig}),r.a.createElement(I,{buttonName:"A",currentPromptButton:this.state.currentPromptButton,button:U.Controller.BUTTON_A,prevButton:U.Controller.BUTTON_DOWN,keys:this.state.keys,handleClick:this.listenForKey,gamepadConfig:this.state.gamepadConfig}),r.a.createElement(I,{buttonName:"B",currentPromptButton:this.state.currentPromptButton,button:U.Controller.BUTTON_B,prevButton:U.Controller.BUTTON_A,keys:this.state.keys,handleClick:this.listenForKey,gamepadConfig:this.state.gamepadConfig}),r.a.createElement(I,{buttonName:"Start",currentPromptButton:this.state.currentPromptButton,button:U.Controller.BUTTON_START,prevButton:U.Controller.BUTTON_B,keys:this.state.keys,handleClick:this.listenForKey,gamepadConfig:this.state.gamepadConfig}),r.a.createElement(I,{buttonName:"Select",currentPromptButton:this.state.currentPromptButton,button:U.Controller.BUTTON_SELECT,prevButton:U.Controller.BUTTON_START,keys:this.state.keys,handleClick:this.listenForKey,gamepadConfig:this.state.gamepadConfig})))),r.a.createElement(E.a,null,r.a.createElement(v.a,{outline:!0,color:"primary",onClick:this.props.toggle},"Close")))}}]),t}(a.Component),P=n(21),j=n.n(P),x=function(){function e(t){var n=this;Object(i.a)(this,e),this.onAnimationFrame=function(e){n.requestAnimationFrame();var t=e%n.interval,a=e-t;if(n.lastFrameTime){var r=Math.round((a-n.lastFrameTime)/n.interval);if(0!==r){n.generateFrame(),n.onWriteFrame();for(var o=n.interval-t,s=1;s<r;s++)setTimeout((function(){n.generateFrame()}),s*o/r);r>1&&console.log("SKIP",r-1,n.lastFrameTime)}}else n.lastFrameTime=a},this.onGenerateFrame=t.onGenerateFrame,this.onWriteFrame=t.onWriteFrame,this.onAnimationFrame=this.onAnimationFrame.bind(this),this.running=!0,this.interval=1e3/60.098,this.lastFrameTime=!1}return Object(l.a)(e,[{key:"start",value:function(){this.running=!0,this.requestAnimationFrame()}},{key:"stop",value:function(){this.running=!1,this._requestID&&window.cancelAnimationFrame(this._requestID),this.lastFrameTime=!1}},{key:"requestAnimationFrame",value:function(){this._requestID=window.requestAnimationFrame(this.onAnimationFrame)}},{key:"generateFrame",value:function(){this.onGenerateFrame(),this.lastFrameTime+=this.interval}}]),e}(),G=function e(t){var n=this;Object(i.a)(this,e),this.disableIfGamepadEnabled=function(e){var t=n;return function(n,a){if(!t.gamepadConfig)return e(n,a);var r=t.gamepadConfig.playerGamepadId;return r&&r[n-1]?void 0:e(n,a)}},this._getPlayerNumberFromGamepad=function(e){return n.gamepadConfig.playerGamepadId[0]===e.id?1:n.gamepadConfig.playerGamepadId[1]===e.id?2:1},this.poll=function(){for(var e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads(),t=[],a=0;a<e.length;a++){var r=e[a],o=n.gamepadState[a];if(r)if(o){var s=r.buttons,i=o.buttons;if(n.buttonCallback){for(var l=0;l<r.axes.length;l++){var u=r.axes[l],c=o.axes[l];-1===u&&-1!==c&&n.buttonCallback({gamepadId:r.id,type:"axis",code:l,value:u}),1===u&&1!==c&&n.buttonCallback({gamepadId:r.id,type:"axis",code:l,value:u})}for(var m=0;m<s.length;m++){var p=s[m],d=i[m];p.pressed&&!d.pressed&&n.buttonCallback({gamepadId:r.id,type:"button",code:m})}}else if(n.gamepadConfig){var h=n._getPlayerNumberFromGamepad(r);if(t.length<2&&(-1!==t.indexOf(h)&&++h>2&&(h=1),t.push(h),n.gamepadConfig.configs[r.id]))for(var f=n.gamepadConfig.configs[r.id].buttons,g=0;g<f.length;g++){var y=f[g];if("button"===y.type){var v=y.code,b=s[v],C=i[v];b.pressed&&!C.pressed?n.onButtonDown(h,y.buttonId):!b.pressed&&C.pressed&&n.onButtonUp(h,y.buttonId)}else if("axis"===y.type){var k=y.code,B=r.axes[k],T=o.axes[k];B===y.value&&T!==y.value&&n.onButtonDown(h,y.buttonId),B!==y.value&&T===y.value&&n.onButtonUp(h,y.buttonId)}}}n.gamepadState[a]={buttons:s.map((function(e){return{pressed:e.pressed}})),axes:r.axes.slice(0)}}else n.gamepadState[a]=r}},this.promptButton=function(e){n.buttonCallback=e?function(t){n.buttonCallback=null,e(t)}:e},this.loadGamepadConfig=function(){var e;try{(e=localStorage.getItem("gamepadConfig"))&&(e=JSON.parse(e))}catch(t){console.log("Failed to get gamepadConfig from localStorage.",t)}n.gamepadConfig=e},this.setGamepadConfig=function(e){try{localStorage.setItem("gamepadConfig",JSON.stringify(e)),n.gamepadConfig=e}catch(t){console.log("Failed to set gamepadConfig in localStorage")}},this.startPolling=function(){if(!navigator.getGamepads&&!navigator.webkitGetGamepads)return{stop:function(){}};var e=!1;return requestAnimationFrame((function t(){e||(n.poll(),requestAnimationFrame(t))})),{stop:function(){e=!0}}},this.onButtonDown=t.onButtonDown,this.onButtonUp=t.onButtonUp,this.gamepadState=[],this.buttonCallback=null},A={88:[1,U.Controller.BUTTON_A,"X"],89:[1,U.Controller.BUTTON_B,"Y"],90:[1,U.Controller.BUTTON_B,"Z"],17:[1,U.Controller.BUTTON_SELECT,"Right Ctrl"],13:[1,U.Controller.BUTTON_START,"Enter"],38:[1,U.Controller.BUTTON_UP,"Up"],40:[1,U.Controller.BUTTON_DOWN,"Down"],37:[1,U.Controller.BUTTON_LEFT,"Left"],39:[1,U.Controller.BUTTON_RIGHT,"Right"],103:[2,U.Controller.BUTTON_A,"Num-7"],105:[2,U.Controller.BUTTON_B,"Num-9"],99:[2,U.Controller.BUTTON_SELECT,"Num-3"],97:[2,U.Controller.BUTTON_START,"Num-1"],104:[2,U.Controller.BUTTON_UP,"Num-8"],98:[2,U.Controller.BUTTON_DOWN,"Num-2"],100:[2,U.Controller.BUTTON_LEFT,"Num-4"],102:[2,U.Controller.BUTTON_RIGHT,"Num-6"]},R=function e(t){var n=this;Object(i.a)(this,e),this.loadKeys=function(){var e;try{(e=localStorage.getItem("keys"))&&(e=JSON.parse(e))}catch(t){console.log("Failed to get keys from localStorage.",t)}n.keys=e||A},this.setKeys=function(e){try{localStorage.setItem("keys",JSON.stringify(e)),n.keys=e}catch(t){console.log("Failed to set keys in localStorage")}},this.handleKeyDown=function(e){var t=n.keys[e.keyCode];t&&(n.onButtonDown(t[0],t[1]),e.preventDefault())},this.handleKeyUp=function(e){var t=n.keys[e.keyCode];t&&(n.onButtonUp(t[0],t[1]),e.preventDefault())},this.handleKeyPress=function(e){e.preventDefault()},this.onButtonDown=t.onButtonDown,this.onButtonUp=t.onButtonUp},K=(n(74),function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).setBuffer=function(e){for(var t=0,a=0;a<240;++a)for(var r=0;r<256;++r)t=256*a+r,n.buf32[t]=4278190080|e[t]},n.writeBuffer=function(){n.imageData.data.set(n.buf8),n.context.putImageData(n.imageData,0,0)},n.fitInParent=function(){var e=n.canvas.parentNode,t=e.clientWidth,a=e.clientHeight;256/240<t/a?(n.canvas.style.width="".concat(Math.round(a*(256/240)),"px"),n.canvas.style.height="".concat(a,"px")):(n.canvas.style.width="".concat(t,"px"),n.canvas.style.height="".concat(Math.round(t/(256/240)),"px"))},n.handleMouseDown=function(e){if(n.props.onMouseDown){var t=256/parseFloat(n.canvas.style.width),a=n.canvas.getBoundingClientRect(),r=Math.round((e.clientX-a.left)*t),o=Math.round((e.clientY-a.top)*t);n.props.onMouseDown(r,o)}},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("canvas",{className:"Screen",width:256,height:240,onMouseDown:this.handleMouseDown,onMouseUp:this.props.onMouseUp,ref:function(t){e.canvas=t}})}},{key:"componentDidMount",value:function(){this.initCanvas()}},{key:"componentDidUpdate",value:function(){this.initCanvas()}},{key:"initCanvas",value:function(){this.context=this.canvas.getContext("2d"),this.imageData=this.context.getImageData(0,0,256,240),this.context.fillStyle="black",this.context.fillRect(0,0,256,240),this.buf=new ArrayBuffer(this.imageData.data.length),this.buf8=new Uint8ClampedArray(this.buf),this.buf32=new Uint32Array(this.buf);for(var e=0;e<this.buf32.length;++e)this.buf32[e]=4278190080}},{key:"screenshot",value:function(){var e=new Image;return e.src=this.canvas.toDataURL("image/png"),e}}]),t}(a.Component)),M=n(44),L=n.n(M),_=function(e,t){console.error(e),j.a.captureException(e,{extra:t})},W=function(){function e(t){var n=this,a=t.onBufferUnderrun;Object(i.a)(this,e),this.writeSample=function(e,t){n.buffer.size()/2>=n.bufferSize&&(console.log("Buffer overrun"),n.buffer.deqN(n.bufferSize/2)),n.buffer.enq(e),n.buffer.enq(t)},this.onaudioprocess=function(e){var t=e.outputBuffer.getChannelData(0),a=e.outputBuffer.getChannelData(1),r=t.length;n.buffer.size()<2*r&&n.onBufferUnderrun&&n.onBufferUnderrun(n.buffer.size(),2*r);try{var o=n.buffer.deqN(2*r)}catch(e){var s=n.buffer.size()/2;s>0&&console.log("Buffer underrun (needed ".concat(r,", got ").concat(s,")"));for(var i=0;i<r;i++)t[i]=0,a[i]=0;return}for(var l=0;l<r;l++)t[l]=o[2*l],a[l]=o[2*l+1]},this.onBufferUnderrun=a,this.bufferSize=8192,this.buffer=new L.a(2*this.bufferSize)}return Object(l.a)(e,[{key:"getSampleRate",value:function(){if(!window.AudioContext)return 44100;var e=new window.AudioContext,t=e.sampleRate;return e.close(),t}},{key:"start",value:function(){window.AudioContext&&(this.audioCtx=new window.AudioContext,this.scriptNode=this.audioCtx.createScriptProcessor(1024,0,2),this.scriptNode.onaudioprocess=this.onaudioprocess,this.scriptNode.connect(this.audioCtx.destination))}},{key:"stop",value:function(){this.scriptNode&&(this.scriptNode.disconnect(this.audioCtx.destination),this.scriptNode.onaudioprocess=null,this.scriptNode=null),this.audioCtx&&(this.audioCtx.close().catch(_),this.audioCtx=null)}}]),e}(),q=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).start=function(){n.frameTimer.start(),n.speakers.start(),n.fpsInterval=setInterval((function(){console.log("FPS: ".concat(n.nes.getFPS()))}),1e3)},n.stop=function(){n.frameTimer.stop(),n.speakers.stop(),clearInterval(n.fpsInterval)},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(K,{ref:function(t){e.screen=t},onGenerateFrame:function(){e.nes.frame()},onMouseDown:function(t,n){e.nes.zapperMove(t,n),e.nes.zapperFireDown()},onMouseUp:function(){e.nes.zapperFireUp()}})}},{key:"componentDidMount",value:function(){var e=this;this.fitInParent(),this.speakers=new W({onBufferUnderrun:function(t,n){e.props.paused||(console.log("Buffer underrun, running another frame to try and catch up"),e.frameTimer.generateFrame(),e.speakers.buffer.size()<n&&(console.log("Still buffer underrun, running a second frame"),e.frameTimer.generateFrame()))}}),this.nes=new U.NES({onFrame:this.screen.setBuffer,onStatusUpdate:console.log,onAudioSample:this.speakers.writeSample,sampleRate:this.speakers.getSampleRate()}),window.nes=this.nes,this.frameTimer=new x({onGenerateFrame:j.a.wrap(this.nes.frame),onWriteFrame:j.a.wrap(this.screen.writeBuffer)}),this.gamepadController=new G({onButtonDown:this.nes.buttonDown,onButtonUp:this.nes.buttonUp}),this.gamepadController.loadGamepadConfig(),this.gamepadPolling=this.gamepadController.startPolling(),this.keyboardController=new R({onButtonDown:this.gamepadController.disableIfGamepadEnabled(this.nes.buttonDown),onButtonUp:this.gamepadController.disableIfGamepadEnabled(this.nes.buttonUp)}),this.keyboardController.loadKeys(),document.addEventListener("keydown",this.keyboardController.handleKeyDown),document.addEventListener("keyup",this.keyboardController.handleKeyUp),document.addEventListener("keypress",this.keyboardController.handleKeyPress),this.nes.loadROM(this.props.romData),this.start()}},{key:"componentWillUnmount",value:function(){this.stop(),document.removeEventListener("keydown",this.keyboardController.handleKeyDown),document.removeEventListener("keyup",this.keyboardController.handleKeyUp),document.removeEventListener("keypress",this.keyboardController.handleKeyPress),this.gamepadPolling.stop(),window.nes=void 0}},{key:"componentDidUpdate",value:function(e){this.props.paused!==e.paused&&(this.props.paused?this.stop():this.start())}},{key:"fitInParent",value:function(){this.screen.fitInParent()}}]),t}(a.Component);n(75);var z=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this,e))).load=function(){if(n.props.match.params.slug){var e=n.props.match.params.slug,t=/^local-/.test(e),a=e.split("-")[1],r=t?g.getRomInfoByHash(a):f.ROMS[e];if(!r)return void n.setState({error:"No such ROM: ".concat(e)});if(t){n.setState({romName:r.name});var o=localStorage.getItem("blob-"+a);n.handleLoaded(o)}else n.setState({romName:r.description}),n.currentRequest=function(e,t,n){var a=new XMLHttpRequest;return a.open("GET",e),a.overrideMimeType("text/plain; charset=x-user-defined"),a.onload=function(){if(200===this.status){if(a.responseText.match(/^<!doctype html>/i))return t(new Error("Page not found"));t(null,this.responseText)}else 0===this.status||t(new Error(a.statusText))},a.onerror=function(){t(new Error(a.statusText))},a.onprogress=n,a.send(),a}(r.url,(function(e,t){e?n.setState({error:"Error loading ROM: ".concat(e.message)}):n.handleLoaded(t)}),n.handleProgress)}else if(n.props.location.state&&n.props.location.state.file){var s=new FileReader;s.readAsBinaryString(n.props.location.state.file),s.onload=function(e){n.currentRequest=null,n.handleLoaded(s.result)}}else n.setState({error:"No ROM provided"})},n.handleProgress=function(e){e.lengthComputable&&n.setState({loadedPercent:e.loaded/e.total*100})},n.handleLoaded=function(e){n.setState({running:!0,loading:!1,romData:e})},n.handlePauseResume=function(){n.setState({paused:!n.state.paused})},n.layout=function(){var e=parseFloat(window.getComputedStyle(n.navbar).height);n.screenContainer.style.height="".concat(window.innerHeight-e,"px"),n.emulator&&n.emulator.fitInParent()},n.toggleControlsModal=function(){n.setState({controlsModalOpen:!n.state.controlsModalOpen})},n.state={romName:null,romData:null,running:!1,paused:!1,controlsModalOpen:!1,loading:!0,loadedPercent:3,error:null},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"RunPage"},r.a.createElement("nav",{className:"navbar navbar-expand",ref:function(t){e.navbar=t}},r.a.createElement("ul",{className:"navbar-nav",style:{width:"200px"}},r.a.createElement("li",{className:"navitem"},r.a.createElement(p.b,{to:"/",className:"nav-link"},"\u2039 Back"))),r.a.createElement("ul",{className:"navbar-nav ml-auto mr-auto"},r.a.createElement("li",{className:"navitem"},r.a.createElement("span",{className:"navbar-text mr-3"},this.state.romName))),r.a.createElement("ul",{className:"navbar-nav",style:{width:"200px"}},r.a.createElement("li",{className:"navitem"},r.a.createElement(v.a,{outline:!0,color:"primary",onClick:this.toggleControlsModal,className:"mr-3"},"Controls"),r.a.createElement(v.a,{outline:!0,color:"primary",onClick:this.handlePauseResume,disabled:!this.state.running},this.state.paused?"Resume":"Pause")))),this.state.error?this.state.error:r.a.createElement("div",{className:"screen-container",ref:function(t){e.screenContainer=t}},this.state.loading?r.a.createElement(b.a,{value:this.state.loadedPercent,style:{position:"absolute",width:"70%",left:"15%",top:"48%"}}):this.state.romData?r.a.createElement(q,{romData:this.state.romData,paused:this.state.paused,ref:function(t){e.emulator=t}}):null,this.state.controlsModalOpen&&r.a.createElement(F,{isOpen:this.state.controlsModalOpen,toggle:this.toggleControlsModal,keys:this.emulator.keyboardController.keys,setKeys:this.emulator.keyboardController.setKeys,promptButton:this.emulator.gamepadController.promptButton,gamepadConfig:this.emulator.gamepadController.gamepadConfig,setGamepadConfig:this.emulator.gamepadController.setGamepadConfig})))}},{key:"componentDidMount",value:function(){window.addEventListener("resize",this.layout),this.layout(),this.load()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.layout),this.currentRequest&&this.currentRequest.abort()}}]),t}(a.Component),H=(n(76),function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this,e))).state={error:null},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return this.state.error?r.a.createElement("div",{className:"container my-4"},r.a.createElement("div",{className:"row justify-content-center"},r.a.createElement("div",{className:"col-md-8"},"Oops - there has been an error. It has been logged to the console."))):r.a.createElement(p.a,{basename:"/nes"},r.a.createElement("div",{className:"App"},r.a.createElement(d.a,{exact:!0,path:"/",component:y}),r.a.createElement(d.a,{exact:!0,path:"/run",component:z}),r.a.createElement(d.a,{exact:!0,path:"/run/:slug",component:z})))}},{key:"componentDidCatch",value:function(e,t){this.setState({error:e}),_(e,t)}}]),t}(a.Component));n(77);s.a.render(r.a.createElement(H,null),document.getElementById("root"))}},[[46,1,2]]]);
//# sourceMappingURL=main.5b222c20.chunk.js.map