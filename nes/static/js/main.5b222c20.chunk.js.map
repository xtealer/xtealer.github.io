{"version":3,"sources":["config.js","RomLibrary.js","ListPage.js","ControlMapperRow.js","ControlsModal.js","FrameTimer.js","GamepadController.js","KeyboardController.js","Screen.js","utils.js","Speakers.js","Emulator.js","RunPage.js","App.js","index.js"],"names":["config","ROMS","name","url","Castlevania","Yoshi","arkanoid","croom","galaga","lj65","mappy","starforce","xevious","RomLibrary","getRomInfoByHash","hash","this","load","find","rom","save","file","Promise","resolve","reject","reader","FileReader","onload","readAsBinaryString","pFileReader","then","readFile","byteString","target","result","ab","ArrayBuffer","length","ia","Uint8Array","i","charCodeAt","crypto","subtle","digest","buffer","Array","from","map","b","toString","padStart","join","hashFile","savedRomInfo","localStorage","getItem","existingLibrary","JSON","parse","added","Date","now","newRomInfo","stringify","concat","setItem","delete","removeItem","filter","ListPage","props","deleteRom","updateLibrary","setState","romLibrary","handleDragOver","e","preventDefault","dataTransfer","dropEffect","handleDrop","items","getAsFile","files","history","push","pathname","state","className","onDragOver","onDrop","href","ListGroup","Object","keys","sort","key","to","encodeURIComponent","a","onClick","title","Component","ControlMapperRow","playerOneButton","playerTwoButton","waitingForKey","handleClick","bind","button","playerButtons","console","log","prevProps","prevState","gamepadButton","newButton","searchButton","gamepadConfig","buttonId","buttons","searchNewButton","prevGamepadConfig","some","b2","waitingForKeyPlayer","gamepadButtonName","type","code","value","playerGamepadId","configs","prevButton","newState","currentPromptButton","player","buttonName","GAMEPAD_ICON","ControlsModal","undefined","modified","handleKeyDown","handleGamepadButtonDown","listenForKey","controllerIcon","gamepadId","controllerIconAlt","setKeys","setGamepadConfig","removeKeyListener","promptButton","document","addEventListener","buttonInfo","playerId","slice","newConfig","assign","event","newKeys","keyCode","String","toUpperCase","removeEventListener","Modal","isOpen","toggle","ModalHeader","ModalBody","Table","src","alt","Controller","BUTTON_LEFT","BUTTON_SELECT","BUTTON_RIGHT","BUTTON_UP","BUTTON_DOWN","BUTTON_A","BUTTON_B","BUTTON_START","ModalFooter","Button","outline","color","FrameTimer","onAnimationFrame","time","requestAnimationFrame","excess","interval","newFrameTime","lastFrameTime","numFrames","Math","round","generateFrame","onWriteFrame","timeToNextFrame","setTimeout","onGenerateFrame","running","_requestID","window","cancelAnimationFrame","GamepadController","options","disableIfGamepadEnabled","callback","self","_getPlayerNumberFromGamepad","gamepad","id","poll","gamepads","navigator","getGamepads","webkitGetGamepads","usedPlayers","gamepadIndex","previousGamepad","gamepadState","previousButtons","buttonCallback","axes","axis","previousAxis","previousButton","pressed","playerNumber","indexOf","configButtons","configButton","onButtonDown","onButtonUp","f","loadGamepadConfig","startPolling","stop","stopped","loop","KEYS","88","89","90","17","13","38","40","37","39","103","105","99","97","104","98","100","102","KeyboardController","loadKeys","handleKeyUp","handleKeyPress","Screen","setBuffer","y","x","buf32","writeBuffer","imageData","data","set","buf8","context","putImageData","fitInParent","parent","canvas","parentNode","parentWidth","clientWidth","parentHeight","clientHeight","style","width","height","handleMouseDown","onMouseDown","scale","parseFloat","rect","getBoundingClientRect","clientX","left","clientY","top","onMouseUp","ref","initCanvas","getContext","getImageData","fillStyle","fillRect","buf","Uint8ClampedArray","Uint32Array","img","Image","toDataURL","handleError","error","errorInfo","Raven","captureException","extra","Speakers","onBufferUnderrun","writeSample","right","size","bufferSize","deqN","enq","onaudioprocess","outputBuffer","getChannelData","samples","j","RingBuffer","AudioContext","myCtx","sampleRate","close","audioCtx","scriptNode","createScriptProcessor","connect","destination","disconnect","catch","Emulator","start","frameTimer","speakers","fpsInterval","setInterval","nes","getFPS","clearInterval","screen","frame","zapperMove","zapperFireDown","zapperFireUp","actualSize","desiredSize","paused","NES","onFrame","onStatusUpdate","onAudioSample","getSampleRate","wrap","gamepadController","buttonDown","buttonUp","gamepadPolling","keyboardController","loadROM","romData","RunPage","match","params","slug","isLocalROM","test","romHash","split","romInfo","romName","localROMData","handleLoaded","description","currentRequest","path","handleProgress","req","XMLHttpRequest","open","overrideMimeType","status","responseText","Error","statusText","onerror","onprogress","send","loadBinary","err","message","location","lengthComputable","loadedPercent","loaded","total","loading","handlePauseResume","layout","navbarHeight","getComputedStyle","navbar","screenContainer","innerHeight","emulator","toggleControlsModal","controlsModalOpen","el","disabled","Progress","position","abort","App","basename","exact","component","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.5b222c20.chunk.js","sourcesContent":["const config = {\n\tROMS: {\n\t\t'1943': {\n\t\t\tname: '1943',\n\t\t\turl: '../roms/1943.nes'\n\t\t},\n\t\t'Bugs Bunny Crazy Castle': {\n\t\t\tname: 'Bugs Bunny Crazy Castle',\n\t\t\turl: '../roms/Bugs Bunny Crazy Castle.nes'\n\t\t},\n\t\t\"Castlevania 2 - Simon's Quest (U)\": {\n\t\t\tname: \"Castlevania 2 - Simon's Quest (U)\",\n\t\t\turl: \"../roms/Castlevania 2 - Simon's Quest (U).nes\"\n\t\t},\n\t\t\"Castlevania 3 - Dracula's Curse (U)\": {\n\t\t\tname: \"Castlevania 3 - Dracula's Curse (U)\",\n\t\t\turl: \"../roms/Castlevania 3 - Dracula's Curse (U).nes\"\n\t\t},\n\t\tCastlevania: {\n\t\t\tname: 'Castlevania',\n\t\t\turl: '../roms/Castlevania.nes'\n\t\t},\n\t\t'Guerrilla War (U)': {\n\t\t\tname: 'Guerrilla War (U)',\n\t\t\turl: '../roms/Guerrilla War (U).nes'\n\t\t},\n\t\t'Star Trek - 25th Anniversary': {\n\t\t\tname: 'Star Trek - 25th Anniversary',\n\t\t\turl: '../roms/Star Trek - 25th Anniversary.nes'\n\t\t},\n\t\t'Star Trek - The Next Generation (U)': {\n\t\t\tname: 'Star Trek - The Next Generation (U)',\n\t\t\turl: '../roms/Star Trek - The Next Generation (U).nes'\n\t\t},\n\t\t'Star Voyager': {\n\t\t\tname: 'Star Voyager',\n\t\t\turl: '../roms/Star Voyager.nes'\n\t\t},\n\t\t'Star Wars - The Empire Strikes Back': {\n\t\t\tname: 'Star Wars - The Empire Strikes Back',\n\t\t\turl: '../roms/Star Wars - The Empire Strikes Back.nes'\n\t\t},\n\t\t'Star Wars': {\n\t\t\tname: 'Star Wars',\n\t\t\turl: '../roms/Star Wars.nes'\n\t\t},\n\t\t'Starship Hector': {\n\t\t\tname: 'Starship Hector',\n\t\t\turl: '../roms/Starship Hector.nes'\n\t\t},\n\t\t'Super Mario Bros 2': {\n\t\t\tname: 'Super Mario Bros 2',\n\t\t\turl: '../roms/Super Mario Bros 2.nes'\n\t\t},\n\t\t'Super Mario Bros 3': {\n\t\t\tname: 'Super Mario Bros 3',\n\t\t\turl: '../roms/Super Mario Bros 3.nes'\n\t\t},\n\t\tYoshi: {\n\t\t\tname: 'Yoshi',\n\t\t\turl: '../roms/Yoshi.nes'\n\t\t},\n\t\t'Zelda 2 - The Adventure of Link': {\n\t\t\tname: 'Zelda 2 - The Adventure of Link',\n\t\t\turl: '../roms/Zelda 2 - The Adventure of Link.nes'\n\t\t},\n\t\tarkanoid: {\n\t\t\tname: 'arkanoid',\n\t\t\turl: '../roms/arkanoid.nes'\n\t\t},\n\t\t'contra-1': {\n\t\t\tname: 'contra-1',\n\t\t\turl: '../roms/contra-1.nes'\n\t\t},\n\t\tcroom: {\n\t\t\tname: 'croom',\n\t\t\turl: '../roms/croom.nes'\n\t\t},\n\t\tgalaga: {\n\t\t\tname: 'galaga',\n\t\t\turl: '../roms/galaga.nes'\n\t\t},\n\t\t'kirby-adventures-1': {\n\t\t\tname: 'kirby-adventures-1',\n\t\t\turl: '../roms/kirby-adventures-1.nes'\n\t\t},\n\t\tlj65: {\n\t\t\tname: 'lj65',\n\t\t\turl: '../roms/lj65.nes'\n\t\t},\n\t\t'lunar-pool': {\n\t\t\tname: 'lunar-pool',\n\t\t\turl: '../roms/lunar-pool.nes'\n\t\t},\n\t\tmappy: {\n\t\t\tname: 'mappy',\n\t\t\turl: '../roms/mappy.nes'\n\t\t},\n\t\t'pac-man': {\n\t\t\tname: 'pac-man',\n\t\t\turl: '../roms/pac-man.nes'\n\t\t},\n\t\t'road-fighter': {\n\t\t\tname: 'road-fighter',\n\t\t\turl: '../roms/road-fighter.nes'\n\t\t},\n\t\tstarforce: {\n\t\t\tname: 'starforce',\n\t\t\turl: '../roms/starforce.nes'\n\t\t},\n\t\t'tetris-original': {\n\t\t\tname: 'tetris-original',\n\t\t\turl: '../roms/tetris-original.nes'\n\t\t},\n\t\txevious: {\n\t\t\tname: 'xevious',\n\t\t\turl: '../roms/xevious.nes'\n\t\t}\n\t}\n};\n\nexport default config;\n","const pFileReader = function(file) {\n  return new Promise((resolve, reject) => {\n    var reader = new FileReader();\n    reader.onload = resolve;\n    reader.readAsBinaryString(file);\n  });\n};\n\nconst hashFile = function(byteString) {\n  const asHex = buffer => {\n    return Array.from(new Uint8Array(buffer))\n      .map(b => b.toString(16).padStart(2, \"0\"))\n      .join(\"\");\n  };\n\n  const ab = new ArrayBuffer(byteString.length);\n  var ia = new Uint8Array(ab);\n\n  for (var i = 0; i < byteString.length; i++) {\n    ia[i] = byteString.charCodeAt(i);\n  }\n\n  return crypto.subtle.digest(\"SHA-1\", ab).then(asHex);\n};\n\nconst RomLibrary = {\n  getRomInfoByHash: function(hash) {\n    return this.load().find(rom => rom.hash === hash);\n  },\n  save: function(file) {\n    return pFileReader(file)\n      .then(function(readFile) {\n        const byteString = readFile.target.result;\n        return hashFile(byteString).then(hash => {\n          return { hash, byteString };\n        });\n      })\n      .then(({ hash, byteString }) => {\n        const savedRomInfo = localStorage.getItem(\"savedRomInfo\");\n        const existingLibrary = savedRomInfo ? JSON.parse(savedRomInfo) : [];\n\n        const rom = {\n          name: file.name,\n          hash: hash,\n          added: Date.now()\n        };\n\n        const newRomInfo = JSON.stringify(existingLibrary.concat([rom]));\n\n        localStorage.setItem(\"savedRomInfo\", newRomInfo);\n        localStorage.setItem(\"blob-\" + hash, byteString);\n\n        return rom;\n      });\n  },\n  load: function() {\n    const localData = localStorage.getItem(\"savedRomInfo\");\n    if (!localData) return [];\n    const savedRomInfo = JSON.parse(localStorage.getItem(\"savedRomInfo\"));\n    return savedRomInfo || [];\n  },\n  delete: function(hash) {\n    const existingLibrary = this.load();\n    localStorage.removeItem(\"blob-\" + hash);\n    localStorage.setItem(\n      \"savedRomInfo\",\n      JSON.stringify(existingLibrary.filter(rom => rom.hash !== hash))\n    );\n  }\n};\n\nexport default RomLibrary;\n","import React, { Component } from 'react';\nimport './ListPage.css';\nimport { ListGroup, Button } from 'reactstrap';\nimport { Link } from 'react-router-dom';\nimport config from './config';\n\nimport RomLibrary from './RomLibrary';\n\nclass ListPage extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t\tromLibrary: RomLibrary.load()\n\t\t};\n\t}\n\trender() {\n\t\treturn (\n\t\t\t<div className=\"container ListPage my-4\" onDragOver={this.handleDragOver} onDrop={this.handleDrop}>\n\t\t\t\t<div className=\"row justify-content-center\">\n\t\t\t\t\t<div className=\"col-md-8\">\n\t\t\t\t\t\t<header className=\"mb-4\">\n\t\t\t\t\t\t\t<h1 className=\"mb-3\">JSNES</h1>\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\tA JavaScript NES emulator.{' '}\n\t\t\t\t\t\t\t\t<a href=\"https://github.com/bfirsh/jsnes\">Source on GitHub.</a>\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</header>\n\n\t\t\t\t\t\t<ListGroup className=\"mb-4\">\n\t\t\t\t\t\t\t{Object.keys(config.ROMS).sort().map((key) => (\n\t\t\t\t\t\t\t\t<Link key={key} to={'/run/' + encodeURIComponent(key)} className=\"list-group-item\">\n\t\t\t\t\t\t\t\t\t{config.ROMS[key]['name']}\n\t\t\t\t\t\t\t\t\t<span className=\"float-right\">&rsaquo;</span>\n\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</ListGroup>\n\n\t\t\t\t\t\t<p>Or, drag and drop a ROM file onto the page to play it. (Google may help you find them.)</p>\n\n\t\t\t\t\t\t{this.state.romLibrary.length > 0 ? (\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<p>Previously played:</p>\n\n\t\t\t\t\t\t\t\t<ListGroup className=\"mb-4\">\n\t\t\t\t\t\t\t\t\t{this.state.romLibrary\n\t\t\t\t\t\t\t\t\t\t.sort((a, b) => new Date(b.added) - new Date(a.added))\n\t\t\t\t\t\t\t\t\t\t.map((rom) => (\n\t\t\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\t\t\tkey={rom.hash}\n\t\t\t\t\t\t\t\t\t\t\t\tto={'/run/local-' + rom.hash}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"list-group-item\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{rom.name}\n\t\t\t\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.deleteRom(rom.hash);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"delete\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Delete\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t&times;\n\t\t\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"float-right\">&rsaquo;</span>\n\t\t\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</ListGroup>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t) : null}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n\n\tdeleteRom = (hash) => {\n\t\tRomLibrary.delete(hash);\n\t\tthis.updateLibrary();\n\t};\n\n\tupdateLibrary = () => {\n\t\tthis.setState({ romLibrary: RomLibrary.load() });\n\t};\n\n\thandleDragOver = (e) => {\n\t\te.preventDefault();\n\t\te.dataTransfer.dropEffect = 'copy';\n\t};\n\n\thandleDrop = (e) => {\n\t\te.preventDefault();\n\n\t\tconst file = e.dataTransfer.items ? e.dataTransfer.items[0].getAsFile() : e.dataTransfer.files[0];\n\n\t\tRomLibrary.save(file).then((rom) => {\n\t\t\tthis.updateLibrary();\n\t\t\tthis.props.history.push({ pathname: '/run/local-' + rom.hash });\n\t\t});\n\t};\n}\n\nexport default ListPage;\n","import React, { Component } from \"react\";\n\nclass ControlMapperRow extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      playerOneButton: \"\",\n      playerTwoButton: \"\",\n      waitingForKey: 0\n    };\n    this.handleClick = this.handleClick.bind(this);\n  }\n\n  componentDidMount() {\n    var keys = this.props.keys;\n    var button = this.props.button;\n    var playerButtons = [];\n    for (var key in keys) {\n      if (keys[key][0] === 1 && keys[key][1] === button) {\n        playerButtons[0] = keys[key][2];\n        console.log(playerButtons[0]);\n      } else if (keys[key][0] === 2 && keys[key][1] === button) {\n        playerButtons[1] = keys[key][2];\n      }\n    }\n    this.setState({\n      playerOneButton: playerButtons[0],\n      playerTwoButton: playerButtons[1]\n    });\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    var keys = this.props.keys;\n    var button = this.props.button;\n    var playerButtons = [];\n    var gamepadButton;\n    var newButton;\n\n    for (var key in keys) {\n      if (keys[key][0] === 1 && keys[key][1] === button) {\n        playerButtons[0] = keys[key][2];\n        console.log(playerButtons[0]);\n      } else if (keys[key][0] === 2 && keys[key][1] === button) {\n        playerButtons[1] = keys[key][2];\n      }\n    }\n\n    var searchButton = (gamepadConfig, buttonId) => {\n      return gamepadConfig.buttons.filter(b => b.buttonId === buttonId)[0];\n    };\n\n    var searchNewButton = (prevGamepadConfig, gamepadConfig) => {\n      return gamepadConfig.buttons.filter(b => {\n        return (\n          !prevGamepadConfig ||\n          !prevGamepadConfig.buttons.some(b2 => b2.buttonId === b.buttonId)\n        );\n      })[0];\n    };\n\n    var waitingForKey = 0;\n    var waitingForKeyPlayer = 0;\n\n    var gamepadButtonName = gamepadButton => {\n      if (gamepadButton.type === \"button\") return \"Btn-\" + gamepadButton.code;\n      if (gamepadButton.type === \"axis\")\n        return \"Axis-\" + gamepadButton.code + \" \" + gamepadButton.value;\n    };\n\n    if (this.props.gamepadConfig && this.props.gamepadConfig.playerGamepadId) {\n      const playerGamepadId = this.props.gamepadConfig.playerGamepadId;\n      if (playerGamepadId[0]) {\n        playerButtons[0] = \"\";\n        gamepadButton = searchButton(\n          this.props.gamepadConfig.configs[playerGamepadId[0]],\n          button\n        );\n        newButton = searchNewButton(\n          prevProps.gamepadConfig.configs[playerGamepadId[0]],\n          this.props.gamepadConfig.configs[playerGamepadId[0]]\n        );\n        if (gamepadButton) {\n          playerButtons[0] = gamepadButtonName(gamepadButton);\n        } else {\n          if (newButton && newButton.buttonId === this.props.prevButton) {\n            if (!waitingForKey) {\n              waitingForKey = 1;\n              waitingForKeyPlayer = 1;\n            }\n          }\n        }\n      }\n\n      if (playerGamepadId[1]) {\n        playerButtons[1] = \"\";\n        gamepadButton = searchButton(\n          this.props.gamepadConfig.configs[playerGamepadId[1]],\n          button\n        );\n        newButton = searchNewButton(\n          prevProps.gamepadConfig.configs[playerGamepadId[1]],\n          this.props.gamepadConfig.configs[playerGamepadId[1]]\n        );\n        if (gamepadButton) {\n          playerButtons[1] = gamepadButtonName(gamepadButton);\n        } else {\n          if (newButton && newButton.buttonId === this.props.prevButton) {\n            if (!waitingForKey) {\n              waitingForKey = 2;\n              waitingForKeyPlayer = 2;\n            }\n          }\n        }\n      }\n    }\n\n    var newState = {};\n\n    if (waitingForKey) {\n      this.props.handleClick([waitingForKeyPlayer, this.props.button]);\n    }\n    // Prevent setState being called repeatedly\n    if (\n      prevState.playerOneButton !== playerButtons[0] ||\n      prevState.playerTwoButton !== playerButtons[1]\n    ) {\n      newState.playerOneButton = playerButtons[0];\n      newState.playerTwoButton = playerButtons[1];\n    }\n\n    if (waitingForKey) {\n      newState.waitingForKey = waitingForKey;\n    } else if (prevState.waitingForKey === 1) {\n      if (this.props.currentPromptButton !== this.props.button) {\n        newState.waitingForKey = 0;\n      }\n    } else if (prevState.waitingForKey === 2) {\n      if (this.props.currentPromptButton !== this.props.button) {\n        newState.waitingForKey = 0;\n      }\n    }\n\n    if (Object.keys(newState).length > 0) {\n      this.setState(newState);\n    }\n  }\n\n  handleClick(player) {\n    this.props.handleClick([player, this.props.button]);\n    this.setState({\n      waitingForKey: player\n    });\n  }\n\n  render() {\n    const waitingText = \"Press key or button...\";\n    return (\n      <tr>\n        <td>{this.props.buttonName}</td>\n        <td onClick={() => this.handleClick(1)}>\n          {this.state.waitingForKey === 1\n            ? waitingText\n            : this.state.playerOneButton}\n        </td>\n        <td onClick={() => this.handleClick(2)}>\n          {this.state.waitingForKey === 2\n            ? waitingText\n            : this.state.playerTwoButton}\n        </td>\n      </tr>\n    );\n  }\n}\n\nexport default ControlMapperRow;\n","import React, { Component } from \"react\";\nimport {\n  Button,\n  Modal,\n  ModalHeader,\n  ModalBody,\n  ModalFooter,\n  Table\n} from \"reactstrap\";\nimport { Controller } from \"jsnes\";\nimport ControlMapperRow from \"./ControlMapperRow\";\n\nconst GAMEPAD_ICON = \"../img/nes_controller.png\";\nconst KEYBOARD_ICON = \"../img/keyboard.png\";\n\nclass ControlsModal extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      gamepadConfig: props.gamepadConfig,\n      keys: props.keys,\n      button: undefined,\n      modified: false\n    };\n    this.handleKeyDown = this.handleKeyDown.bind(this);\n    this.handleGamepadButtonDown = this.handleGamepadButtonDown.bind(this);\n    this.listenForKey = this.listenForKey.bind(this);\n\n    this.state.gamepadConfig = this.state.gamepadConfig || {};\n    this.state.gamepadConfig.playerGamepadId = this.state.gamepadConfig\n      .playerGamepadId || [null, null];\n    this.state.gamepadConfig.configs = this.state.gamepadConfig.configs || {};\n\n    this.state.controllerIcon = this.state.gamepadConfig.playerGamepadId.map(\n      gamepadId => (gamepadId ? GAMEPAD_ICON : KEYBOARD_ICON)\n    );\n    this.state.controllerIconAlt = this.state.gamepadConfig.playerGamepadId.map(\n      gamepadId => (gamepadId ? \"gamepad\" : \"keyboard\")\n    );\n    this.state.currentPromptButton = -1;\n  }\n\n  componentWillUnmount() {\n    if (this.state.modified) {\n      this.props.setKeys(this.state.keys);\n      this.props.setGamepadConfig(this.state.gamepadConfig);\n    }\n    this.removeKeyListener();\n  }\n\n  listenForKey(button) {\n    var currentPromptButton = button[1];\n\n    this.removeKeyListener();\n    this.setState({ button, currentPromptButton });\n    this.props.promptButton(this.handleGamepadButtonDown);\n    document.addEventListener(\"keydown\", this.handleKeyDown);\n  }\n\n  handleGamepadButtonDown(buttonInfo) {\n    this.removeKeyListener();\n\n    var button = this.state.button;\n\n    const playerId = button[0];\n    const buttonId = button[1];\n\n    const gamepadId = buttonInfo.gamepadId;\n    const gamepadConfig = this.state.gamepadConfig;\n\n    // link player to gamepad\n    const playerGamepadId = gamepadConfig.playerGamepadId.slice(0);\n    const newConfig = {};\n\n    playerGamepadId[playerId - 1] = gamepadId;\n\n    const rejectButtonId = b => {\n      return b.buttonId !== buttonId;\n    };\n\n    const newButton = {\n      code: buttonInfo.code,\n      type: buttonInfo.type,\n      buttonId: buttonId,\n      value: buttonInfo.value\n    };\n    newConfig[gamepadId] = {\n      buttons: (gamepadConfig.configs[gamepadId] || { buttons: [] }).buttons\n        .filter(rejectButtonId)\n        .concat([newButton])\n    };\n\n    const configs = Object.assign({}, gamepadConfig.configs, newConfig);\n\n    this.setState({\n      gamepadConfig: {\n        configs: configs,\n        playerGamepadId: playerGamepadId\n      },\n      currentPromptButton: -1,\n      controllerIcon: playerGamepadId.map(gamepadId =>\n        gamepadId ? GAMEPAD_ICON : KEYBOARD_ICON\n      ),\n      modified: true\n    });\n  }\n\n  handleKeyDown(event) {\n    this.removeKeyListener();\n\n    var button = this.state.button;\n    var keys = this.state.keys;\n    var newKeys = {};\n    for (var key in keys) {\n      if (keys[key][0] !== button[0] || keys[key][1] !== button[1]) {\n        newKeys[key] = keys[key];\n      }\n    }\n\n    const playerGamepadId = this.state.gamepadConfig.playerGamepadId.slice(0);\n    const playerId = button[0];\n    playerGamepadId[playerId - 1] = null;\n\n    this.setState({\n      keys: {\n        ...newKeys,\n        [event.keyCode]: [\n          ...button.slice(0, 2),\n          event.key.length > 1 ? event.key : String(event.key).toUpperCase()\n        ]\n      },\n      button: undefined,\n      gamepadConfig: {\n        configs: this.state.gamepadConfig.configs,\n        playerGamepadId: playerGamepadId\n      },\n      currentPromptButton: -1,\n      controllerIcon: playerGamepadId.map(gamepadId =>\n        gamepadId ? GAMEPAD_ICON : KEYBOARD_ICON\n      ),\n      controllerIconAlt: playerGamepadId.map(gamepadId =>\n        gamepadId ? \"gamepad\" : \"keyboard\"\n      ),\n      modified: true\n    });\n  }\n\n  removeKeyListener() {\n    this.props.promptButton(null);\n    document.removeEventListener(\"keydown\", this.handleKeyDown);\n  }\n\n  render() {\n    return (\n      <Modal\n        isOpen={this.props.isOpen}\n        toggle={this.props.toggle}\n        className=\"ControlsModal\"\n      >\n        <ModalHeader toggle={this.props.toggle}>Controls</ModalHeader>\n        <ModalBody>\n          <Table>\n            <thead>\n              <tr>\n                <th>Button</th>\n                <th>\n                  Player 1\n                  <img\n                    className=\"controller-icon\"\n                    src={this.state.controllerIcon[0]}\n                    alt={this.state.controllerIconAlt[0]}\n                  />\n                </th>\n                <th>\n                  Player 2\n                  <img\n                    className=\"controller-icon\"\n                    src={this.state.controllerIcon[1]}\n                    alt={this.state.controllerIconAlt[1]}\n                  />\n                </th>\n              </tr>\n            </thead>\n            <tbody>\n              <ControlMapperRow\n                buttonName=\"Left\"\n                currentPromptButton={this.state.currentPromptButton}\n                button={Controller.BUTTON_LEFT}\n                prevButton={Controller.BUTTON_SELECT}\n                keys={this.state.keys}\n                handleClick={this.listenForKey}\n                gamepadConfig={this.state.gamepadConfig}\n              />\n              <ControlMapperRow\n                buttonName=\"Right\"\n                currentPromptButton={this.state.currentPromptButton}\n                button={Controller.BUTTON_RIGHT}\n                prevButton={Controller.BUTTON_LEFT}\n                keys={this.state.keys}\n                handleClick={this.listenForKey}\n                gamepadConfig={this.state.gamepadConfig}\n              />\n              <ControlMapperRow\n                buttonName=\"Up\"\n                currentPromptButton={this.state.currentPromptButton}\n                button={Controller.BUTTON_UP}\n                prevButton={Controller.BUTTON_RIGHT}\n                keys={this.state.keys}\n                handleClick={this.listenForKey}\n                gamepadConfig={this.state.gamepadConfig}\n              />\n              <ControlMapperRow\n                buttonName=\"Down\"\n                currentPromptButton={this.state.currentPromptButton}\n                button={Controller.BUTTON_DOWN}\n                prevButton={Controller.BUTTON_UP}\n                keys={this.state.keys}\n                handleClick={this.listenForKey}\n                gamepadConfig={this.state.gamepadConfig}\n              />\n              <ControlMapperRow\n                buttonName=\"A\"\n                currentPromptButton={this.state.currentPromptButton}\n                button={Controller.BUTTON_A}\n                prevButton={Controller.BUTTON_DOWN}\n                keys={this.state.keys}\n                handleClick={this.listenForKey}\n                gamepadConfig={this.state.gamepadConfig}\n              />\n              <ControlMapperRow\n                buttonName=\"B\"\n                currentPromptButton={this.state.currentPromptButton}\n                button={Controller.BUTTON_B}\n                prevButton={Controller.BUTTON_A}\n                keys={this.state.keys}\n                handleClick={this.listenForKey}\n                gamepadConfig={this.state.gamepadConfig}\n              />\n              <ControlMapperRow\n                buttonName=\"Start\"\n                currentPromptButton={this.state.currentPromptButton}\n                button={Controller.BUTTON_START}\n                prevButton={Controller.BUTTON_B}\n                keys={this.state.keys}\n                handleClick={this.listenForKey}\n                gamepadConfig={this.state.gamepadConfig}\n              />\n              <ControlMapperRow\n                buttonName=\"Select\"\n                currentPromptButton={this.state.currentPromptButton}\n                button={Controller.BUTTON_SELECT}\n                prevButton={Controller.BUTTON_START}\n                keys={this.state.keys}\n                handleClick={this.listenForKey}\n                gamepadConfig={this.state.gamepadConfig}\n              />\n            </tbody>\n          </Table>\n        </ModalBody>\n        <ModalFooter>\n          <Button outline color=\"primary\" onClick={this.props.toggle}>\n            Close\n          </Button>\n        </ModalFooter>\n      </Modal>\n    );\n  }\n}\n\nexport default ControlsModal;\n","const FPS = 60.098;\n\nexport default class FrameTimer {\n  constructor(props) {\n    // Run at 60 FPS\n    this.onGenerateFrame = props.onGenerateFrame;\n    // Run on animation frame\n    this.onWriteFrame = props.onWriteFrame;\n    this.onAnimationFrame = this.onAnimationFrame.bind(this);\n    this.running = true;\n    this.interval = 1e3 / FPS;\n    this.lastFrameTime = false;\n  }\n\n  start() {\n    this.running = true;\n    this.requestAnimationFrame();\n  }\n\n  stop() {\n    this.running = false;\n    if (this._requestID) window.cancelAnimationFrame(this._requestID);\n    this.lastFrameTime = false;\n  }\n\n  requestAnimationFrame() {\n    this._requestID = window.requestAnimationFrame(this.onAnimationFrame);\n  }\n\n  generateFrame() {\n    this.onGenerateFrame();\n    this.lastFrameTime += this.interval;\n  }\n\n  onAnimationFrame = time => {\n    this.requestAnimationFrame();\n    // how many ms after 60fps frame time\n    let excess = time % this.interval;\n\n    // newFrameTime is the current time aligned to 60fps intervals.\n    // i.e. 16.6, 33.3, etc ...\n    let newFrameTime = time - excess;\n\n    // first frame, do nothing\n    if (!this.lastFrameTime) {\n      this.lastFrameTime = newFrameTime;\n      return;\n    }\n\n    let numFrames = Math.round(\n      (newFrameTime - this.lastFrameTime) / this.interval\n    );\n\n    // This can happen a lot on a 144Hz display\n    if (numFrames === 0) {\n      //console.log(\"WOAH, no frames\");\n      return;\n    }\n\n    // update display on first frame only\n    this.generateFrame();\n    this.onWriteFrame();\n\n    // we generate additional frames evenly before the next\n    // onAnimationFrame call.\n    // additional frames are generated but not displayed\n    // until next frame draw\n    let timeToNextFrame = this.interval - excess;\n    for (let i = 1; i < numFrames; i++) {\n      setTimeout(() => {\n        this.generateFrame();\n      }, (i * timeToNextFrame) / numFrames);\n    }\n    if (numFrames > 1) console.log(\"SKIP\", numFrames - 1, this.lastFrameTime);\n  };\n}\n","export default class GamepadController {\n  constructor(options) {\n    this.onButtonDown = options.onButtonDown;\n    this.onButtonUp = options.onButtonUp;\n    this.gamepadState = [];\n    this.buttonCallback = null;\n  }\n\n  disableIfGamepadEnabled = callback => {\n    var self = this;\n    return (playerId, buttonId) => {\n      if (!self.gamepadConfig) {\n        return callback(playerId, buttonId);\n      }\n\n      var playerGamepadId = self.gamepadConfig.playerGamepadId;\n      if (!playerGamepadId || !playerGamepadId[playerId - 1]) {\n        // allow callback only if player is not associated to any gamepad\n        return callback(playerId, buttonId);\n      }\n    };\n  };\n\n  _getPlayerNumberFromGamepad = gamepad => {\n    if (this.gamepadConfig.playerGamepadId[0] === gamepad.id) {\n      return 1;\n    }\n\n    if (this.gamepadConfig.playerGamepadId[1] === gamepad.id) {\n      return 2;\n    }\n\n    return 1;\n  };\n\n  poll = () => {\n    const gamepads = navigator.getGamepads\n      ? navigator.getGamepads()\n      : navigator.webkitGetGamepads();\n\n    const usedPlayers = [];\n\n    for (let gamepadIndex = 0; gamepadIndex < gamepads.length; gamepadIndex++) {\n      const gamepad = gamepads[gamepadIndex];\n      const previousGamepad = this.gamepadState[gamepadIndex];\n\n      if (!gamepad) {\n        continue;\n      }\n\n      if (!previousGamepad) {\n        this.gamepadState[gamepadIndex] = gamepad;\n        continue;\n      }\n\n      const buttons = gamepad.buttons;\n      const previousButtons = previousGamepad.buttons;\n\n      if (this.buttonCallback) {\n        for (let code = 0; code < gamepad.axes.length; code++) {\n          const axis = gamepad.axes[code];\n          const previousAxis = previousGamepad.axes[code];\n\n          if (axis === -1 && previousAxis !== -1) {\n            this.buttonCallback({\n              gamepadId: gamepad.id,\n              type: \"axis\",\n              code: code,\n              value: axis\n            });\n          }\n\n          if (axis === 1 && previousAxis !== 1) {\n            this.buttonCallback({\n              gamepadId: gamepad.id,\n              type: \"axis\",\n              code: code,\n              value: axis\n            });\n          }\n        }\n\n        for (let code = 0; code < buttons.length; code++) {\n          const button = buttons[code];\n          const previousButton = previousButtons[code];\n          if (button.pressed && !previousButton.pressed) {\n            this.buttonCallback({\n              gamepadId: gamepad.id,\n              type: \"button\",\n              code: code\n            });\n          }\n        }\n      } else if (this.gamepadConfig) {\n        let playerNumber = this._getPlayerNumberFromGamepad(gamepad);\n        if (usedPlayers.length < 2) {\n          if (usedPlayers.indexOf(playerNumber) !== -1) {\n            playerNumber++;\n            if (playerNumber > 2) playerNumber = 1;\n          }\n          usedPlayers.push(playerNumber);\n\n          if (this.gamepadConfig.configs[gamepad.id]) {\n            const configButtons = this.gamepadConfig.configs[gamepad.id]\n              .buttons;\n\n            for (let i = 0; i < configButtons.length; i++) {\n              const configButton = configButtons[i];\n              if (configButton.type === \"button\") {\n                const code = configButton.code;\n                const button = buttons[code];\n                const previousButton = previousButtons[code];\n\n                if (button.pressed && !previousButton.pressed) {\n                  this.onButtonDown(playerNumber, configButton.buttonId);\n                } else if (!button.pressed && previousButton.pressed) {\n                  this.onButtonUp(playerNumber, configButton.buttonId);\n                }\n              } else if (configButton.type === \"axis\") {\n                const code = configButton.code;\n                const axis = gamepad.axes[code];\n                const previousAxis = previousGamepad.axes[code];\n\n                if (\n                  axis === configButton.value &&\n                  previousAxis !== configButton.value\n                ) {\n                  this.onButtonDown(playerNumber, configButton.buttonId);\n                }\n\n                if (\n                  axis !== configButton.value &&\n                  previousAxis === configButton.value\n                ) {\n                  this.onButtonUp(playerNumber, configButton.buttonId);\n                }\n              }\n            }\n          }\n        }\n      }\n\n      this.gamepadState[gamepadIndex] = {\n        buttons: buttons.map(b => {\n          return { pressed: b.pressed };\n        }),\n        axes: gamepad.axes.slice(0)\n      };\n    }\n  };\n\n  promptButton = f => {\n    if (!f) {\n      this.buttonCallback = f;\n    } else {\n      this.buttonCallback = buttonInfo => {\n        this.buttonCallback = null;\n        f(buttonInfo);\n      };\n    }\n  };\n\n  loadGamepadConfig = () => {\n    var gamepadConfig;\n    try {\n      gamepadConfig = localStorage.getItem(\"gamepadConfig\");\n      if (gamepadConfig) {\n        gamepadConfig = JSON.parse(gamepadConfig);\n      }\n    } catch (e) {\n      console.log(\"Failed to get gamepadConfig from localStorage.\", e);\n    }\n\n    this.gamepadConfig = gamepadConfig;\n  };\n\n  setGamepadConfig = gamepadConfig => {\n    try {\n      localStorage.setItem(\"gamepadConfig\", JSON.stringify(gamepadConfig));\n      this.gamepadConfig = gamepadConfig;\n    } catch (e) {\n      console.log(\"Failed to set gamepadConfig in localStorage\");\n    }\n  };\n\n  startPolling = () => {\n    if (!(navigator.getGamepads || navigator.webkitGetGamepads)) {\n      return { stop: () => {} };\n    }\n\n    let stopped = false;\n    const loop = () => {\n      if (stopped) return;\n\n      this.poll();\n      requestAnimationFrame(loop);\n    };\n    requestAnimationFrame(loop);\n\n    return {\n      stop: () => {\n        stopped = true;\n      }\n    };\n  };\n}\n","import { Controller } from \"jsnes\";\n\n// Mapping keyboard code to [controller, button]\nconst KEYS = {\n  88: [1, Controller.BUTTON_A, \"X\"], // X\n  89: [1, Controller.BUTTON_B, \"Y\"], // Y (Central European keyboard)\n  90: [1, Controller.BUTTON_B, \"Z\"], // Z\n  17: [1, Controller.BUTTON_SELECT, \"Right Ctrl\"], // Right Ctrl\n  13: [1, Controller.BUTTON_START, \"Enter\"], // Enter\n  38: [1, Controller.BUTTON_UP, \"Up\"], // Up\n  40: [1, Controller.BUTTON_DOWN, \"Down\"], // Down\n  37: [1, Controller.BUTTON_LEFT, \"Left\"], // Left\n  39: [1, Controller.BUTTON_RIGHT, \"Right\"], // Right\n  103: [2, Controller.BUTTON_A, \"Num-7\"], // Num-7\n  105: [2, Controller.BUTTON_B, \"Num-9\"], // Num-9\n  99: [2, Controller.BUTTON_SELECT, \"Num-3\"], // Num-3\n  97: [2, Controller.BUTTON_START, \"Num-1\"], // Num-1\n  104: [2, Controller.BUTTON_UP, \"Num-8\"], // Num-8\n  98: [2, Controller.BUTTON_DOWN, \"Num-2\"], // Num-2\n  100: [2, Controller.BUTTON_LEFT, \"Num-4\"], // Num-4\n  102: [2, Controller.BUTTON_RIGHT, \"Num-6\"] // Num-6\n};\n\nexport default class KeyboardController {\n  constructor(options) {\n    this.onButtonDown = options.onButtonDown;\n    this.onButtonUp = options.onButtonUp;\n  }\n\n  loadKeys = () => {\n    var keys;\n    try {\n      keys = localStorage.getItem(\"keys\");\n      if (keys) {\n        keys = JSON.parse(keys);\n      }\n    } catch (e) {\n      console.log(\"Failed to get keys from localStorage.\", e);\n    }\n\n    this.keys = keys || KEYS;\n  };\n\n  setKeys = newKeys => {\n    try {\n      localStorage.setItem(\"keys\", JSON.stringify(newKeys));\n      this.keys = newKeys;\n    } catch (e) {\n      console.log(\"Failed to set keys in localStorage\");\n    }\n  };\n\n  handleKeyDown = e => {\n    var key = this.keys[e.keyCode];\n    if (key) {\n      this.onButtonDown(key[0], key[1]);\n      e.preventDefault();\n    }\n  };\n\n  handleKeyUp = e => {\n    var key = this.keys[e.keyCode];\n    if (key) {\n      this.onButtonUp(key[0], key[1]);\n      e.preventDefault();\n    }\n  };\n\n  handleKeyPress = e => {\n    e.preventDefault();\n  };\n}\n","import React, { Component } from \"react\";\nimport \"./Screen.css\";\n\nconst SCREEN_WIDTH = 256;\nconst SCREEN_HEIGHT = 240;\n\nclass Screen extends Component {\n  render() {\n    return (\n      <canvas\n        className=\"Screen\"\n        width={SCREEN_WIDTH}\n        height={SCREEN_HEIGHT}\n        onMouseDown={this.handleMouseDown}\n        onMouseUp={this.props.onMouseUp}\n        ref={canvas => {\n          this.canvas = canvas;\n        }}\n      />\n    );\n  }\n\n  componentDidMount() {\n    this.initCanvas();\n  }\n\n  componentDidUpdate() {\n    this.initCanvas();\n  }\n\n  initCanvas() {\n    this.context = this.canvas.getContext(\"2d\");\n    this.imageData = this.context.getImageData(\n      0,\n      0,\n      SCREEN_WIDTH,\n      SCREEN_HEIGHT\n    );\n\n    this.context.fillStyle = \"black\";\n    // set alpha to opaque\n    this.context.fillRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);\n\n    // buffer to write on next animation frame\n    this.buf = new ArrayBuffer(this.imageData.data.length);\n    // Get the canvas buffer in 8bit and 32bit\n    this.buf8 = new Uint8ClampedArray(this.buf);\n    this.buf32 = new Uint32Array(this.buf);\n\n    // Set alpha\n    for (var i = 0; i < this.buf32.length; ++i) {\n      this.buf32[i] = 0xff000000;\n    }\n  }\n\n  setBuffer = buffer => {\n    var i = 0;\n    for (var y = 0; y < SCREEN_HEIGHT; ++y) {\n      for (var x = 0; x < SCREEN_WIDTH; ++x) {\n        i = y * 256 + x;\n        // Convert pixel from NES BGR to canvas ABGR\n        this.buf32[i] = 0xff000000 | buffer[i]; // Full alpha\n      }\n    }\n  };\n\n  writeBuffer = () => {\n    this.imageData.data.set(this.buf8);\n    this.context.putImageData(this.imageData, 0, 0);\n  };\n\n  fitInParent = () => {\n    let parent = this.canvas.parentNode;\n    // @ts-ignore\n    let parentWidth = parent.clientWidth;\n    // @ts-ignore\n    let parentHeight = parent.clientHeight;\n    let parentRatio = parentWidth / parentHeight;\n    let desiredRatio = SCREEN_WIDTH / SCREEN_HEIGHT;\n    if (desiredRatio < parentRatio) {\n      this.canvas.style.width = `${Math.round(parentHeight * desiredRatio)}px`;\n      this.canvas.style.height = `${parentHeight}px`;\n    } else {\n      this.canvas.style.width = `${parentWidth}px`;\n      this.canvas.style.height = `${Math.round(parentWidth / desiredRatio)}px`;\n    }\n  };\n\n  screenshot() {\n    var img = new Image();\n    img.src = this.canvas.toDataURL(\"image/png\");\n    return img;\n  }\n\n  handleMouseDown = e => {\n    if (!this.props.onMouseDown) return;\n    // Make coordinates unscaled\n    let scale = SCREEN_WIDTH / parseFloat(this.canvas.style.width);\n    let rect = this.canvas.getBoundingClientRect();\n    let x = Math.round((e.clientX - rect.left) * scale);\n    let y = Math.round((e.clientY - rect.top) * scale);\n    this.props.onMouseDown(x, y);\n  };\n}\n\nexport default Screen;\n","import Raven from \"raven-js\";\n\nexport const handleError = (error, errorInfo) => {\n  console.error(error);\n  Raven.captureException(error, { extra: errorInfo });\n};\n","import RingBuffer from \"ringbufferjs\";\nimport { handleError } from \"./utils\";\n\nexport default class Speakers {\n  constructor({ onBufferUnderrun }) {\n    this.onBufferUnderrun = onBufferUnderrun;\n    this.bufferSize = 8192;\n    this.buffer = new RingBuffer(this.bufferSize * 2);\n  }\n\n  getSampleRate() {\n    if (!window.AudioContext) {\n      return 44100;\n    }\n    let myCtx = new window.AudioContext();\n    let sampleRate = myCtx.sampleRate;\n    myCtx.close();\n    return sampleRate;\n  }\n\n  start() {\n    // Audio is not supported\n    if (!window.AudioContext) {\n      return;\n    }\n    this.audioCtx = new window.AudioContext();\n    this.scriptNode = this.audioCtx.createScriptProcessor(1024, 0, 2);\n    this.scriptNode.onaudioprocess = this.onaudioprocess;\n    this.scriptNode.connect(this.audioCtx.destination);\n  }\n\n  stop() {\n    if (this.scriptNode) {\n      this.scriptNode.disconnect(this.audioCtx.destination);\n      this.scriptNode.onaudioprocess = null;\n      this.scriptNode = null;\n    }\n    if (this.audioCtx) {\n      this.audioCtx.close().catch(handleError);\n      this.audioCtx = null;\n    }\n  }\n\n  writeSample = (left, right) => {\n    if (this.buffer.size() / 2 >= this.bufferSize) {\n      console.log(`Buffer overrun`);\n      this.buffer.deqN(this.bufferSize / 2);\n    }\n    this.buffer.enq(left);\n    this.buffer.enq(right);\n  };\n\n  onaudioprocess = e => {\n    var left = e.outputBuffer.getChannelData(0);\n    var right = e.outputBuffer.getChannelData(1);\n    var size = left.length;\n\n    // We're going to buffer underrun. Attempt to fill the buffer.\n    if (this.buffer.size() < size * 2 && this.onBufferUnderrun) {\n      this.onBufferUnderrun(this.buffer.size(), size * 2);\n    }\n\n    try {\n      var samples = this.buffer.deqN(size * 2);\n    } catch (e) {\n      // onBufferUnderrun failed to fill the buffer, so handle a real buffer\n      // underrun\n\n      // ignore empty buffers... assume audio has just stopped\n      var bufferSize = this.buffer.size() / 2;\n      if (bufferSize > 0) {\n        console.log(`Buffer underrun (needed ${size}, got ${bufferSize})`);\n      }\n      for (var j = 0; j < size; j++) {\n        left[j] = 0;\n        right[j] = 0;\n      }\n      return;\n    }\n    for (var i = 0; i < size; i++) {\n      left[i] = samples[i * 2];\n      right[i] = samples[i * 2 + 1];\n    }\n  };\n}\n","import Raven from \"raven-js\";\nimport React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { NES } from \"jsnes\";\n\nimport FrameTimer from \"./FrameTimer\";\nimport GamepadController from \"./GamepadController\";\nimport KeyboardController from \"./KeyboardController\";\nimport Screen from \"./Screen\";\nimport Speakers from \"./Speakers\";\n\n/*\n * Runs the emulator.\n *\n * The only UI is a canvas element. It assumes it is a singleton in various ways\n * (binds to window, keyboard, speakers, etc).\n */\nclass Emulator extends Component {\n  render() {\n    return (\n      <Screen\n        ref={screen => {\n          this.screen = screen;\n        }}\n        onGenerateFrame={() => {\n          this.nes.frame();\n        }}\n        onMouseDown={(x, y) => {\n          this.nes.zapperMove(x, y);\n          this.nes.zapperFireDown();\n        }}\n        onMouseUp={() => {\n          this.nes.zapperFireUp();\n        }}\n      />\n    );\n  }\n\n  componentDidMount() {\n    // Initial layout\n    this.fitInParent();\n\n    this.speakers = new Speakers({\n      onBufferUnderrun: (actualSize, desiredSize) => {\n        if (this.props.paused) {\n          return;\n        }\n        // Skip a video frame so audio remains consistent. This happens for\n        // a variety of reasons:\n        // - Frame rate is not quite 60fps, so sometimes buffer empties\n        // - Page is not visible, so requestAnimationFrame doesn't get fired.\n        //   In this case emulator still runs at full speed, but timing is\n        //   done by audio instead of requestAnimationFrame.\n        // - System can't run emulator at full speed. In this case it'll stop\n        //    firing requestAnimationFrame.\n        console.log(\n          \"Buffer underrun, running another frame to try and catch up\"\n        );\n\n        this.frameTimer.generateFrame();\n        // desiredSize will be 2048, and the NES produces 1468 samples on each\n        // frame so we might need a second frame to be run. Give up after that\n        // though -- the system is not catching up\n        if (this.speakers.buffer.size() < desiredSize) {\n          console.log(\"Still buffer underrun, running a second frame\");\n          this.frameTimer.generateFrame();\n        }\n      }\n    });\n\n    this.nes = new NES({\n      onFrame: this.screen.setBuffer,\n      onStatusUpdate: console.log,\n      onAudioSample: this.speakers.writeSample,\n      sampleRate: this.speakers.getSampleRate()\n    });\n\n    // For debugging. ([\"nes\"] instead of .nes to avoid VS Code type errors.)\n    window[\"nes\"] = this.nes;\n\n    this.frameTimer = new FrameTimer({\n      onGenerateFrame: Raven.wrap(this.nes.frame),\n      onWriteFrame: Raven.wrap(this.screen.writeBuffer)\n    });\n\n    // Set up gamepad and keyboard\n    this.gamepadController = new GamepadController({\n      onButtonDown: this.nes.buttonDown,\n      onButtonUp: this.nes.buttonUp\n    });\n\n    this.gamepadController.loadGamepadConfig();\n    this.gamepadPolling = this.gamepadController.startPolling();\n\n    this.keyboardController = new KeyboardController({\n      onButtonDown: this.gamepadController.disableIfGamepadEnabled(\n        this.nes.buttonDown\n      ),\n      onButtonUp: this.gamepadController.disableIfGamepadEnabled(\n        this.nes.buttonUp\n      )\n    });\n\n    // Load keys from localStorage (if they exist)\n    this.keyboardController.loadKeys();\n\n    document.addEventListener(\"keydown\", this.keyboardController.handleKeyDown);\n    document.addEventListener(\"keyup\", this.keyboardController.handleKeyUp);\n    document.addEventListener(\n      \"keypress\",\n      this.keyboardController.handleKeyPress\n    );\n\n    this.nes.loadROM(this.props.romData);\n    this.start();\n  }\n\n  componentWillUnmount() {\n    this.stop();\n\n    // Unbind keyboard\n    document.removeEventListener(\n      \"keydown\",\n      this.keyboardController.handleKeyDown\n    );\n    document.removeEventListener(\"keyup\", this.keyboardController.handleKeyUp);\n    document.removeEventListener(\n      \"keypress\",\n      this.keyboardController.handleKeyPress\n    );\n\n    // Stop gamepad\n    this.gamepadPolling.stop();\n\n    window[\"nes\"] = undefined;\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.paused !== prevProps.paused) {\n      if (this.props.paused) {\n        this.stop();\n      } else {\n        this.start();\n      }\n    }\n\n    // TODO: handle changing romData\n  }\n\n  start = () => {\n    this.frameTimer.start();\n    this.speakers.start();\n    this.fpsInterval = setInterval(() => {\n      console.log(`FPS: ${this.nes.getFPS()}`);\n    }, 1000);\n  };\n\n  stop = () => {\n    this.frameTimer.stop();\n    this.speakers.stop();\n    clearInterval(this.fpsInterval);\n  };\n\n  /*\n   * Fill parent element with screen. Typically called if parent element changes size.\n   */\n  fitInParent() {\n    this.screen.fitInParent();\n  }\n}\n\nEmulator.propTypes = {\n  paused: PropTypes.bool,\n  romData: PropTypes.string.isRequired\n};\n\nexport default Emulator;\n","import React, { Component } from 'react';\nimport { Button, Progress } from 'reactstrap';\nimport { Link } from 'react-router-dom';\n\nimport config from './config';\nimport ControlsModal from './ControlsModal';\nimport Emulator from './Emulator';\nimport RomLibrary from './RomLibrary';\n\nimport './RunPage.css';\n\nfunction loadBinary(path, callback, handleProgress) {\n\tvar req = new XMLHttpRequest();\n\treq.open('GET', path);\n\treq.overrideMimeType('text/plain; charset=x-user-defined');\n\treq.onload = function() {\n\t\tif (this.status === 200) {\n\t\t\tif (req.responseText.match(/^<!doctype html>/i)) {\n\t\t\t\t// Got HTML back, so it is probably falling back to index.html due to 404\n\t\t\t\treturn callback(new Error('Page not found'));\n\t\t\t}\n\n\t\t\tcallback(null, this.responseText);\n\t\t} else if (this.status === 0) {\n\t\t\t// Aborted, so ignore error\n\t\t} else {\n\t\t\tcallback(new Error(req.statusText));\n\t\t}\n\t};\n\treq.onerror = function() {\n\t\tcallback(new Error(req.statusText));\n\t};\n\treq.onprogress = handleProgress;\n\treq.send();\n\treturn req;\n}\n\n/*\n * The UI for the emulator. Also responsible for loading ROM from URL or file.\n */\nclass RunPage extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t\tromName: null,\n\t\t\tromData: null,\n\t\t\trunning: false,\n\t\t\tpaused: false,\n\t\t\tcontrolsModalOpen: false,\n\t\t\tloading: true,\n\t\t\tloadedPercent: 3,\n\t\t\terror: null\n\t\t};\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<div className=\"RunPage\">\n\t\t\t\t<nav\n\t\t\t\t\tclassName=\"navbar navbar-expand\"\n\t\t\t\t\tref={(el) => {\n\t\t\t\t\t\tthis.navbar = el;\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<ul className=\"navbar-nav\" style={{ width: '200px' }}>\n\t\t\t\t\t\t<li className=\"navitem\">\n\t\t\t\t\t\t\t<Link to=\"/\" className=\"nav-link\">\n\t\t\t\t\t\t\t\t&lsaquo; Back\n\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</ul>\n\t\t\t\t\t<ul className=\"navbar-nav ml-auto mr-auto\">\n\t\t\t\t\t\t<li className=\"navitem\">\n\t\t\t\t\t\t\t<span className=\"navbar-text mr-3\">{this.state.romName}</span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</ul>\n\t\t\t\t\t<ul className=\"navbar-nav\" style={{ width: '200px' }}>\n\t\t\t\t\t\t<li className=\"navitem\">\n\t\t\t\t\t\t\t<Button outline color=\"primary\" onClick={this.toggleControlsModal} className=\"mr-3\">\n\t\t\t\t\t\t\t\tControls\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\toutline\n\t\t\t\t\t\t\t\tcolor=\"primary\"\n\t\t\t\t\t\t\t\tonClick={this.handlePauseResume}\n\t\t\t\t\t\t\t\tdisabled={!this.state.running}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{this.state.paused ? 'Resume' : 'Pause'}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</ul>\n\t\t\t\t</nav>\n\n\t\t\t\t{this.state.error ? (\n\t\t\t\t\tthis.state.error\n\t\t\t\t) : (\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName=\"screen-container\"\n\t\t\t\t\t\tref={(el) => {\n\t\t\t\t\t\t\tthis.screenContainer = el;\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t{this.state.loading ? (\n\t\t\t\t\t\t\t<Progress\n\t\t\t\t\t\t\t\tvalue={this.state.loadedPercent}\n\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\tposition: 'absolute',\n\t\t\t\t\t\t\t\t\twidth: '70%',\n\t\t\t\t\t\t\t\t\tleft: '15%',\n\t\t\t\t\t\t\t\t\ttop: '48%'\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) : this.state.romData ? (\n\t\t\t\t\t\t\t<Emulator\n\t\t\t\t\t\t\t\tromData={this.state.romData}\n\t\t\t\t\t\t\t\tpaused={this.state.paused}\n\t\t\t\t\t\t\t\tref={(emulator) => {\n\t\t\t\t\t\t\t\t\tthis.emulator = emulator;\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) : null}\n\n\t\t\t\t\t\t{/* TODO: lift keyboard and gamepad state up */}\n\t\t\t\t\t\t{this.state.controlsModalOpen && (\n\t\t\t\t\t\t\t<ControlsModal\n\t\t\t\t\t\t\t\tisOpen={this.state.controlsModalOpen}\n\t\t\t\t\t\t\t\ttoggle={this.toggleControlsModal}\n\t\t\t\t\t\t\t\tkeys={this.emulator.keyboardController.keys}\n\t\t\t\t\t\t\t\tsetKeys={this.emulator.keyboardController.setKeys}\n\t\t\t\t\t\t\t\tpromptButton={this.emulator.gamepadController.promptButton}\n\t\t\t\t\t\t\t\tgamepadConfig={this.emulator.gamepadController.gamepadConfig}\n\t\t\t\t\t\t\t\tsetGamepadConfig={this.emulator.gamepadController.setGamepadConfig}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t);\n\t}\n\n\tcomponentDidMount() {\n\t\twindow.addEventListener('resize', this.layout);\n\t\tthis.layout();\n\t\tthis.load();\n\t}\n\n\tcomponentWillUnmount() {\n\t\twindow.removeEventListener('resize', this.layout);\n\t\tif (this.currentRequest) {\n\t\t\tthis.currentRequest.abort();\n\t\t}\n\t}\n\n\tload = () => {\n\t\tif (this.props.match.params.slug) {\n\t\t\tconst slug = this.props.match.params.slug;\n\t\t\tconst isLocalROM = /^local-/.test(slug);\n\t\t\tconst romHash = slug.split('-')[1];\n\t\t\tconst romInfo = isLocalROM ? RomLibrary.getRomInfoByHash(romHash) : config.ROMS[slug];\n\n\t\t\tif (!romInfo) {\n\t\t\t\tthis.setState({ error: `No such ROM: ${slug}` });\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (isLocalROM) {\n\t\t\t\tthis.setState({ romName: romInfo.name });\n\t\t\t\tconst localROMData = localStorage.getItem('blob-' + romHash);\n\t\t\t\tthis.handleLoaded(localROMData);\n\t\t\t} else {\n\t\t\t\tthis.setState({ romName: romInfo.description });\n\t\t\t\tthis.currentRequest = loadBinary(\n\t\t\t\t\tromInfo.url,\n\t\t\t\t\t(err, data) => {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\tthis.setState({ error: `Error loading ROM: ${err.message}` });\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.handleLoaded(data);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tthis.handleProgress\n\t\t\t\t);\n\t\t\t}\n\t\t} else if (this.props.location.state && this.props.location.state.file) {\n\t\t\tlet reader = new FileReader();\n\t\t\treader.readAsBinaryString(this.props.location.state.file);\n\t\t\treader.onload = (e) => {\n\t\t\t\tthis.currentRequest = null;\n\t\t\t\tthis.handleLoaded(reader.result);\n\t\t\t};\n\t\t} else {\n\t\t\tthis.setState({ error: 'No ROM provided' });\n\t\t}\n\t};\n\n\thandleProgress = (e) => {\n\t\tif (e.lengthComputable) {\n\t\t\tthis.setState({ loadedPercent: e.loaded / e.total * 100 });\n\t\t}\n\t};\n\n\thandleLoaded = (data) => {\n\t\tthis.setState({ running: true, loading: false, romData: data });\n\t};\n\n\thandlePauseResume = () => {\n\t\tthis.setState({ paused: !this.state.paused });\n\t};\n\n\tlayout = () => {\n\t\tlet navbarHeight = parseFloat(window.getComputedStyle(this.navbar).height);\n\t\tthis.screenContainer.style.height = `${window.innerHeight - navbarHeight}px`;\n\t\tif (this.emulator) {\n\t\t\tthis.emulator.fitInParent();\n\t\t}\n\t};\n\n\ttoggleControlsModal = () => {\n\t\tthis.setState({ controlsModalOpen: !this.state.controlsModalOpen });\n\t};\n}\n\nexport default RunPage;\n","import React, { Component } from 'react';\nimport { BrowserRouter, Route } from 'react-router-dom';\nimport ListPage from './ListPage';\nimport RunPage from './RunPage';\nimport { handleError } from './utils';\nimport './App.css';\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = { error: null };\n  }\n\n  render() {\n    if (this.state.error) {\n      return (\n        <div className=\"container my-4\">\n          <div className=\"row justify-content-center\">\n            <div className=\"col-md-8\">\n              Oops - there has been an error. It has been logged to the console.\n            </div>\n          </div>\n        </div>\n      );\n    }\n    return (\n      <BrowserRouter basename={'/nes'}>\n        <div className=\"App\">\n          <Route exact path=\"/\" component={ListPage} />\n          <Route exact path=\"/run\" component={RunPage} />\n          <Route exact path=\"/run/:slug\" component={RunPage} />\n        </div>\n      </BrowserRouter>\n    );\n  }\n\n  componentDidCatch(error, errorInfo) {\n    this.setState({ error });\n    handleError(error, errorInfo);\n  }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport './index.scss';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}